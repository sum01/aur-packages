# Maintainer: tommyshem
# Contributor: sum01 <sum01@protonmail.com>
# Previous Maintainer: Atnanasis <ys2000pro@gmail.com>
# Contributor: Youngbin Han <sukso96100@gmail.com>
pkgname=micro-nightly-bin
pkgver=1.3.5_67
pkgrel=1
pkgdesc="A modern and intuitive terminal-based text editor"
arch=('x86_64' 'i686')
url="https://github.com/zyedidia/micro"
license=('MIT')
makedepends=('grep' 'wget' 'tar')
optdepends=('xclip: for copying to and from the terminal')
conflicts=('micro')
provides=('micro')
# source=("https://github.com/zyedidia/micro/releases/download/nightly/micro-${_pkgver}-linux64.tar.gz")
source=('https://api.github.com/repos/zyedidia/micro/releases/tags/nightly')
noextract=('https://api.github.com/repos/zyedidia/micro/releases/tags/nightly')
sha512sums=('SKIP')
pkgver() {
	# Parse out the version number
	_results=$(grep -oEm 1 '[0-9]+\.[0-9]+\.[0-9]+\-[0-9]+' "$srcdir/nightly")
	# Doesn't allow a dash in the pkgver, so replace with underscore
	echo ${_results//-/_}
}
package() {
	cd "$srcdir"
	if [[ $CARCH == "i686" ]]; then
		_bits="32"
	else
		_bits="64"
	fi
	# The actual version has a dash
	_pkgver=${pkgver//_/-}
	wget "https://github.com/zyedidia/micro/releases/download/nightly/micro-${_pkgver}-linux${_bits}.tar.gz"
	tar -xvf "micro-${_pkgver}-linux${_bits}.tar.gz"
	install -Dsm755 $srcdir/micro-${_pkgver}/micro "$pkgdir/usr/bin/micro"
	install -Dm644 $srcdir/micro-${_pkgver}/LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
}
