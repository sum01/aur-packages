# Maintainer: tommyshem
# Contributor: sum01 <sum01@protonmail.com>
# Previous Maintainer: Atnanasis <ys2000pro@gmail.com>
# Contributor: Youngbin Han <sukso96100@gmail.com>
pkgname=micro-nightly-bin
pkgver=1.3.5.68
pkgrel=1
pkgdesc="A modern and intuitive terminal-based text editor"
arch=('x86_64' 'i686')
url="https://github.com/zyedidia/micro"
license=('MIT')
makedepends=('grep' 'wget' 'tar')
optdepends=('xclip: for copying to and from the terminal')
conflicts=('micro')
provides=('micro')
source=('https://api.github.com/repos/zyedidia/micro/releases/tags/nightly')
noextract=('https://api.github.com/repos/zyedidia/micro/releases/tags/nightly')
sha512sums=('SKIP')
pkgver() {
	grep -oEm 1 '[0-9]+\.[0-9]+\.[0-9]+\-(dev\.)?[0-9]+' "$srcdir/nightly" | sed -E 's/\-(dev\.)?/\./'
}
package() {
	cd "$srcdir"
	if [[ $CARCH == "i686" ]]; then
		_bits="32"
	else
		_bits="64"
	fi
	_rawpkgver=$(grep -oEm 1 '[0-9]+\.[0-9]+\.[0-9]+\-(dev\.)?[0-9]+' "$srcdir/nightly")
	wget "https://github.com/zyedidia/micro/releases/download/nightly/micro-${_rawpkgver}-linux${_bits}.tar.gz"
	tar -xvf "micro-${_rawpkgver}-linux${_bits}.tar.gz"
	install -Dsm755 "$srcdir/micro-${_rawpkgver}/micro" "$pkgdir/usr/bin/micro"
	install -Dm644 "$srcdir/micro-${_rawpkgver}/LICENSE" "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
}
